[{"id":"c1b63df6.94fe3","type":"function","z":"134033fa.c8fdfc","name":"live_data_query","func":"var numericID2 = global.get(\"NumericID2\");\n\nif(numericID2 == 401191000 ){\n    var q1 = \"SELECT TRY_CAST([_Max] AS FLOAT)-TRY_CAST([_Min] AS FLOAT) as avg_temp, _date as _hour \"+\n     \"from ( select distinct FORMAT(_TIMESTAMP, 'yyyy-MM-dd') as _date, \"+\n     \"first_value(_VALUE) over (partition by FORMAT(_TIMESTAMP, 'yyyy-MM-dd') \"+\n     \"order by _TIMESTAMP) as [_Min] , first_value(_VALUE) over \"+\n     \"(partition by FORMAT(_TIMESTAMP, 'yyyy-MM-dd') order by _TIMESTAMP desc) as [_Max] \"+\n     \"from [dbo].[KepElEnergy] where _NUMERICID =401191000 AND \"+\n     \"_TIMESTAMP >= CONVERT (date, GETDATE()) ) as ID \"+\n    \" where TRY_CAST([_Max] AS FLOAT)-TRY_CAST([_Min] AS FLOAT) < 1000 \";\n}\nif(numericID2 == 42100068){\n    var q1 = \"SELECT TRY_CAST([_Max] AS FLOAT)-TRY_CAST([_Min] AS FLOAT) as avg_temp, _date \"+\n     \"from ( select distinct FORMAT(_TIMESTAMP, 'yyyy-MM-dd') as _date, \"+\n     \"first_value(_VALUE) over (partition by FORMAT(_TIMESTAMP, 'yyyy-MM-dd') \"+\n     \"order by _TIMESTAMP) as [_Min] , first_value(_VALUE) over \"+\n     \"(partition by FORMAT(_TIMESTAMP, 'yyyy-MM-dd') order by _TIMESTAMP desc) as [_Max] \"+\n     \"from [dbo].[KepEnergyUnits] where _NUMERICID =42100068 AND \"+\n     \"_TIMESTAMP >= CONVERT (date, GETDATE()) ) as ID \"+\n    \" where TRY_CAST([_Max] AS FLOAT)-TRY_CAST([_Min] AS FLOAT) < 1000 \";\n}\nelse{\n  var q1 = \"SELECT AVG(TRY_CAST(_VALUE as FLOAT)) as avg_temp  , DATEPART( hour, _TIMESTAMP ) as _hour  from  [NestTest].[dbo].[KepMET51] \"+\n          \"where _TIMESTAMP >= CONVERT (date, GETDATE())  AND \"+\n           \"kepMet51._NUMERICID= \"+ numericID2 +\n          \" AND TRY_CAST(_VALUE AS FLOAT) < 100 \"+\n          \"group by  DATEPART( hour, _TIMESTAMP )\";  \n}\n\n          \n\n          \nmsg.payload = q1;\nreturn msg;","outputs":1,"noerr":0,"x":253,"y":698,"wires":[["baf0f729.851758"]]}]